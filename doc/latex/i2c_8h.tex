\hypertarget{i2c_8h}{}\section{D\+:/\+G\+I\+T/fhradiov2/driver/i2c.h-\/\+Dateireferenz}
\label{i2c_8h}\index{D\+:/\+G\+I\+T/fhradiov2/driver/i2c.\+h@{D\+:/\+G\+I\+T/fhradiov2/driver/i2c.\+h}}


I2\+C implemtation for M\+S\+P430\+G2553, interrupt based. ~\newline
 This implemtation based on examples from Texas Instruments slaa382. ~\newline
 For more information see link below.  


{\ttfamily \#include $<$stdint.\+h$>$}\\*
{\ttfamily \#include $<$msp430.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$stdarg.\+h$>$}\\*
{\ttfamily \#include $<$driver/timer.\+h$>$}\\*
Include-\/\+Abhängigkeitsdiagramm für i2c.\+h\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c_8h__incl}
\end{center}
\end{figure}
Dieser Graph zeigt, welche Datei direkt oder indirekt diese Datei enthält\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{Makrodefinitionen}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{i2c_8h_abb6e116b2f7cc724b26d78a65303ccc6}{V\+A\+R\+I\+A\+D\+I\+C\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+A\+T\+I\+O\+N}~0
\item 
\#define \hyperlink{i2c_8h_afd2ccfc308be2593bb7540863b903d67}{I2\+C\+\_\+\+M\+A\+X\+\_\+\+A\+R\+G\+S}~10
\end{DoxyCompactItemize}
\subsection*{Aufzählungen}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D} \{ \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a679ee5320d66c8322e310daeb2ee99b8}{S\+T\+O\+P} = 0, 
\hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a807d17ddb75240ddeede2c54fd79bd40}{R\+E\+P\+T}
 \}
\begin{DoxyCompactList}\small\item\em Control command for sendig a S\+T\+O\+P condtion or repeated start. \end{DoxyCompactList}\item 
enum \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9b}{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S} \{ \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{I\+D\+L\+E} = 0, 
\hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bad208fa8c08969a9d78096817bf0a6377}{T\+R\+A\+N\+S\+M\+I\+T}, 
\hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba563f8ed00490ea22ea2605d9571dada8}{R\+E\+C\+E\+I\+V\+E}, 
\hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba2fd6f336d08340583bd620a7f5694c90}{E\+R\+R\+O\+R}
 \}
\begin{DoxyCompactList}\small\item\em Give back a status of I2\+C module. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Funktionen}
\begin{DoxyCompactItemize}
\item 
uint8\+\_\+t \hyperlink{i2c_8h_a1ef889b72b844429bc81225d7b6f4f2e}{i2c\+\_\+init} (uint16\+\_\+t smclk\+\_\+freq, uint16\+\_\+t i2c\+\_\+freq)
\begin{DoxyCompactList}\small\item\em Setup I2\+C with a defined clock based on given S\+M\+C\+K\+L. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{i2c_8h_a6691e5911f539e1e8178c6e983e8079a}{i2c\+\_\+write\+\_\+var} (uint8\+\_\+t addr, enum \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D} rept\+\_\+start, uint8\+\_\+t n\+\_\+args,...)
\begin{DoxyCompactList}\small\item\em Transmits I2\+C commands with a variable length to a I2\+C slave. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978}{i2c\+\_\+write\+\_\+arr} (uint8\+\_\+t addr, enum \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D} rept\+\_\+start, uint8\+\_\+t n\+\_\+size, uint8\+\_\+t $\ast$Tx\+Data)
\begin{DoxyCompactList}\small\item\em Transmits I2\+C command array to a I2\+C slave. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{i2c_8h_a6dd896b0c82d1aa91a1a8155b41c4566}{i2c\+\_\+read} (uint8\+\_\+t addr, enum \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D} rept\+\_\+start, uint8\+\_\+t Rx\+Bytes, uint8\+\_\+t $\ast$Rx\+Data)
\begin{DoxyCompactList}\small\item\em Receives I2\+C commands until a N\+A\+C\+K is received or received Rx\+Bytes. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{i2c_8h_ad2d4889950ea1373a0ea88ba55b04ba8}{i2c\+\_\+get\+\_\+status} ()
\end{DoxyCompactItemize}


\subsection{Ausführliche Beschreibung}
I2\+C implemtation for M\+S\+P430\+G2553, interrupt based. ~\newline
 This implemtation based on examples from Texas Instruments slaa382. ~\newline
 For more information see link below. 

\begin{DoxyAuthor}{Autor}
Richard Treichl 
\end{DoxyAuthor}
\begin{DoxyDate}{Datum}
07.\+02.\+2015
\end{DoxyDate}
\begin{DoxySeeAlso}{Siehe auch}
\href{http://www.ti.com/lit/an/slaa382/slaa382.zip}{\tt http\+://www.\+ti.\+com/lit/an/slaa382/slaa382.\+zip}
\end{DoxySeeAlso}
\begin{DoxyRefDesc}{Noch zu erledigen}
\item[\hyperlink{todo__todo000001}{Noch zu erledigen}]Find a better way for continue \hyperlink{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978}{i2c\+\_\+write\+\_\+arr()} after transmittion on repeated start condition. ~\newline
 Implement error detection, for example wrong configuration for prescale or detect non existing slave.\end{DoxyRefDesc}


\subsection{Makro-\/\+Dokumentation}
\hypertarget{i2c_8h_afd2ccfc308be2593bb7540863b903d67}{}\index{i2c.\+h@{i2c.\+h}!I2\+C\+\_\+\+M\+A\+X\+\_\+\+A\+R\+G\+S@{I2\+C\+\_\+\+M\+A\+X\+\_\+\+A\+R\+G\+S}}
\index{I2\+C\+\_\+\+M\+A\+X\+\_\+\+A\+R\+G\+S@{I2\+C\+\_\+\+M\+A\+X\+\_\+\+A\+R\+G\+S}!i2c.\+h@{i2c.\+h}}
\subsubsection[{I2\+C\+\_\+\+M\+A\+X\+\_\+\+A\+R\+G\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define I2\+C\+\_\+\+M\+A\+X\+\_\+\+A\+R\+G\+S~10}\label{i2c_8h_afd2ccfc308be2593bb7540863b903d67}


Definiert in Zeile 35 der Datei i2c.\+h.

\hypertarget{i2c_8h_abb6e116b2f7cc724b26d78a65303ccc6}{}\index{i2c.\+h@{i2c.\+h}!V\+A\+R\+I\+A\+D\+I\+C\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+A\+T\+I\+O\+N@{V\+A\+R\+I\+A\+D\+I\+C\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+A\+T\+I\+O\+N}}
\index{V\+A\+R\+I\+A\+D\+I\+C\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+A\+T\+I\+O\+N@{V\+A\+R\+I\+A\+D\+I\+C\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+A\+T\+I\+O\+N}!i2c.\+h@{i2c.\+h}}
\subsubsection[{V\+A\+R\+I\+A\+D\+I\+C\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+A\+T\+I\+O\+N}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+A\+R\+I\+A\+D\+I\+C\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+A\+T\+I\+O\+N~0}\label{i2c_8h_abb6e116b2f7cc724b26d78a65303ccc6}


Definiert in Zeile 27 der Datei i2c.\+h.



\subsection{Dokumentation der Aufzählungstypen}
\hypertarget{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}{}\index{i2c.\+h@{i2c.\+h}!I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D@{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}}
\index{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D@{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}!i2c.\+h@{i2c.\+h}}
\subsubsection[{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}}\label{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}


Control command for sendig a S\+T\+O\+P condtion or repeated start. 

\begin{Desc}
\item[Aufzählungswerte]\par
\begin{description}
\index{S\+T\+O\+P@{S\+T\+O\+P}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!S\+T\+O\+P@{S\+T\+O\+P}}\item[{\em 
\hypertarget{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a679ee5320d66c8322e310daeb2ee99b8}{}S\+T\+O\+P\label{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a679ee5320d66c8322e310daeb2ee99b8}
}]If this one is set a stop condtion will be send after trasmition or reception. \index{R\+E\+P\+T@{R\+E\+P\+T}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!R\+E\+P\+T@{R\+E\+P\+T}}\item[{\em 
\hypertarget{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a807d17ddb75240ddeede2c54fd79bd40}{}R\+E\+P\+T\label{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a807d17ddb75240ddeede2c54fd79bd40}
}]If this one is set no stop condtion is send the I2\+C stays low on S\+C\+L and wait for a new start condtion. \end{description}
\end{Desc}


Definiert in Zeile 45 der Datei i2c.\+h.


\begin{DoxyCode}
45                   \{
46     \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a679ee5320d66c8322e310daeb2ee99b8}{STOP} = 0,       
47     \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a807d17ddb75240ddeede2c54fd79bd40}{REPT}            
48 \};
\end{DoxyCode}
\hypertarget{i2c_8h_a8f12d82f4a490ef04de32baf91363d9b}{}\index{i2c.\+h@{i2c.\+h}!I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S@{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S}}
\index{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S@{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S}!i2c.\+h@{i2c.\+h}}
\subsubsection[{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S}}\label{i2c_8h_a8f12d82f4a490ef04de32baf91363d9b}


Give back a status of I2\+C module. 

\begin{Desc}
\item[Aufzählungswerte]\par
\begin{description}
\index{I\+D\+L\+E@{I\+D\+L\+E}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!I\+D\+L\+E@{I\+D\+L\+E}}\item[{\em 
\hypertarget{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{}I\+D\+L\+E\label{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}
}]Indicates that I2\+C module is not performing a command. \index{T\+R\+A\+N\+S\+M\+I\+T@{T\+R\+A\+N\+S\+M\+I\+T}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!T\+R\+A\+N\+S\+M\+I\+T@{T\+R\+A\+N\+S\+M\+I\+T}}\item[{\em 
\hypertarget{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bad208fa8c08969a9d78096817bf0a6377}{}T\+R\+A\+N\+S\+M\+I\+T\label{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bad208fa8c08969a9d78096817bf0a6377}
}]Indicates that I2\+C module is performing a transmittion command. \index{R\+E\+C\+E\+I\+V\+E@{R\+E\+C\+E\+I\+V\+E}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!R\+E\+C\+E\+I\+V\+E@{R\+E\+C\+E\+I\+V\+E}}\item[{\em 
\hypertarget{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba563f8ed00490ea22ea2605d9571dada8}{}R\+E\+C\+E\+I\+V\+E\label{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba563f8ed00490ea22ea2605d9571dada8}
}]Indicates that I2\+C module is performing a reception command. \index{E\+R\+R\+O\+R@{E\+R\+R\+O\+R}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!E\+R\+R\+O\+R@{E\+R\+R\+O\+R}}\item[{\em 
\hypertarget{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba2fd6f336d08340583bd620a7f5694c90}{}E\+R\+R\+O\+R\label{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba2fd6f336d08340583bd620a7f5694c90}
}]Indicates that I2\+C has occured an error. \end{description}
\end{Desc}


Definiert in Zeile 55 der Datei i2c.\+h.


\begin{DoxyCode}
55                     \{
56     \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{IDLE} = 0,       
57     \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bad208fa8c08969a9d78096817bf0a6377}{TRANSMIT},       
58     \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba563f8ed00490ea22ea2605d9571dada8}{RECEIVE},     
59     \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba2fd6f336d08340583bd620a7f5694c90}{ERROR}          
60 \};
\end{DoxyCode}


\subsection{Dokumentation der Funktionen}
\hypertarget{i2c_8h_ad2d4889950ea1373a0ea88ba55b04ba8}{}\index{i2c.\+h@{i2c.\+h}!i2c\+\_\+get\+\_\+status@{i2c\+\_\+get\+\_\+status}}
\index{i2c\+\_\+get\+\_\+status@{i2c\+\_\+get\+\_\+status}!i2c.\+h@{i2c.\+h}}
\subsubsection[{i2c\+\_\+get\+\_\+status}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t i2c\+\_\+get\+\_\+status (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{i2c_8h_ad2d4889950ea1373a0ea88ba55b04ba8}
\begin{DoxyReturn}{Rückgabe}
Actuall state of I2\+C module. 
\end{DoxyReturn}


Definiert in Zeile 179 der Datei i2c.\+c.


\begin{DoxyCode}
180 \{
181     \textcolor{keywordflow}{return} \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status};
182 \}
\end{DoxyCode}
\hypertarget{i2c_8h_a1ef889b72b844429bc81225d7b6f4f2e}{}\index{i2c.\+h@{i2c.\+h}!i2c\+\_\+init@{i2c\+\_\+init}}
\index{i2c\+\_\+init@{i2c\+\_\+init}!i2c.\+h@{i2c.\+h}}
\subsubsection[{i2c\+\_\+init}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t i2c\+\_\+init (
\begin{DoxyParamCaption}
\item[{uint16\+\_\+t}]{smclk\+\_\+freq, }
\item[{uint16\+\_\+t}]{i2c\+\_\+freq}
\end{DoxyParamCaption}
)}\label{i2c_8h_a1ef889b72b844429bc81225d7b6f4f2e}


Setup I2\+C with a defined clock based on given S\+M\+C\+K\+L. 


\begin{DoxyParams}{Parameter}
{\em smclk\+\_\+freq} & Frequency of S\+M\+C\+L\+K clock in Hz \\
\hline
{\em i2c\+\_\+freq} & Frequency for I2\+C clock in Hz \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Rückgabe}
error 
\end{DoxyReturn}


Definiert in Zeile 34 der Datei i2c.\+c.


\begin{DoxyCode}
35 \{
36     \textcolor{comment}{/* Reset USCI\_B0 */}
37     UCB0CTL1 |= UCSWRST;
38 
39     \textcolor{comment}{/* Assign P1.6 and P1.7 to USIC\_B0 */}
40     P1SEL |= BIT6 + BIT7;
41     P1SEL2 |= BIT6 + BIT7;
42 
43     \textcolor{comment}{/* USCI\_B0 as I2C Master */}
44     UCB0CTL0 = UCMST + UCMODE\_3 + UCSYNC;
45 
46     \textcolor{comment}{/* Set SMCLK as clock for USCI\_B0 */}
47     UCB0CTL1 = UCSSEL\_2 + UCSWRST;
48 
49     \textcolor{comment}{/* Calculate prescaler for USCI\_B0 based on SMCLK freq and I2C freq  */}
50     \textcolor{comment}{/*UCB0BR0 = 0x00FF & (uint16\_t)smclk\_freq/i2c\_freq;}
51 \textcolor{comment}{    UCB0BR1 = (0xFF00 & (uint16\_t)smclk\_freq/i2c\_freq) >> 8;*/}
52 
53     UCB0BR0 = 0x14;
54 
55     \textcolor{comment}{/* Enable NACK interrupt */}
56     UCB0I2CIE = UCNACKIE;
57 
58     \textcolor{comment}{/* Resume USCI\_B0 to normal operation state */}
59     UCB0CTL1 &= ~UCSWRST;
60 
61     \textcolor{comment}{/* Enable gloabl interrupts */}
62     \_\_enable\_interrupt();
63 
64     \textcolor{keywordflow}{return} 0;
65 \}
\end{DoxyCode}


Hier ist ein Graph der zeigt, wo diese Funktion aufgerufen wird\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=293pt]{i2c_8h_a1ef889b72b844429bc81225d7b6f4f2e_icgraph}
\end{center}
\end{figure}


\hypertarget{i2c_8h_a6dd896b0c82d1aa91a1a8155b41c4566}{}\index{i2c.\+h@{i2c.\+h}!i2c\+\_\+read@{i2c\+\_\+read}}
\index{i2c\+\_\+read@{i2c\+\_\+read}!i2c.\+h@{i2c.\+h}}
\subsubsection[{i2c\+\_\+read}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t i2c\+\_\+read (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{addr, }
\item[{enum {\bf I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}}]{rept\+\_\+start, }
\item[{uint8\+\_\+t}]{Rx\+Bytes, }
\item[{uint8\+\_\+t $\ast$}]{Rx\+Data}
\end{DoxyParamCaption}
)}\label{i2c_8h_a6dd896b0c82d1aa91a1a8155b41c4566}


Receives I2\+C commands until a N\+A\+C\+K is received or received Rx\+Bytes. 


\begin{DoxyParams}{Parameter}
{\em addr} & Slave Address in 7-\/bit format. \\
\hline
{\em rept\+\_\+start} & Command for stop or repeated start. \\
\hline
{\em Rx\+Bytes} & Number of receiving bytes. \\
\hline
{\em $\ast$\+Rx\+Data} & Pointer where received I2\+C commands are be writtn. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Rückgabe}
error 
\end{DoxyReturn}


Definiert in Zeile 138 der Datei i2c.\+c.


\begin{DoxyCode}
139 \{
140     \textcolor{keywordflow}{while}(\hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{IDLE});
141 
142     \textcolor{comment}{/* Set slave address */}
143     UCB0I2CSA = addr;
144 
145     \textcolor{comment}{/* Change pointer to given buffer */}
146     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a3c8ed69cf31f6ee7aa513fe5f115ba92}{PRxData} = RxData;
147     \textcolor{comment}{/* Load RX counter */}
148     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a37e493c5b47477e45136924079fd9606}{RxByteCtr} = RXBytes;
149 
150     \textcolor{comment}{/* Clear Interrupt */}
151     IE2 = UCB0RXIE;
152 
153     \textcolor{comment}{/* configure receiver mode */}
154     UCB0CTL1 &= ~UCTR;
155 
156     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba563f8ed00490ea22ea2605d9571dada8}{RECEIVE};
157 
158     \textcolor{comment}{/* Send a start condition with read flag */}
159     \textcolor{keywordflow}{if} ( \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a37e493c5b47477e45136924079fd9606}{RxByteCtr} == 1 ) \{
160         \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a37e493c5b47477e45136924079fd9606}{RxByteCtr} = 0;
161         \_\_disable\_interrupt();
162         UCB0CTL1 |= UCTXSTT;
163         \textcolor{keywordflow}{while}(UCB0CTL1 & UCTXSTT);
164         UCB0CTL1 |= UCTXSTP;
165         \_\_enable\_interrupt();
166     \}
167     \textcolor{keywordflow}{else} \{
168         \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a37e493c5b47477e45136924079fd9606}{RxByteCtr} -= 2;
169         UCB0CTL1 |= UCTXSTT;
170     \}
171 
172     \textcolor{keywordflow}{while}(UCB0STAT & UCBBUSY);
173 
174     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{IDLE};
175 
176     \textcolor{keywordflow}{return} 0;
177 \}
\end{DoxyCode}


Hier ist ein Graph der zeigt, wo diese Funktion aufgerufen wird\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c_8h_a6dd896b0c82d1aa91a1a8155b41c4566_icgraph}
\end{center}
\end{figure}


\hypertarget{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978}{}\index{i2c.\+h@{i2c.\+h}!i2c\+\_\+write\+\_\+arr@{i2c\+\_\+write\+\_\+arr}}
\index{i2c\+\_\+write\+\_\+arr@{i2c\+\_\+write\+\_\+arr}!i2c.\+h@{i2c.\+h}}
\subsubsection[{i2c\+\_\+write\+\_\+arr}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t i2c\+\_\+write\+\_\+arr (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{addr, }
\item[{enum {\bf I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}}]{rept\+\_\+start, }
\item[{uint8\+\_\+t}]{n\+\_\+size, }
\item[{uint8\+\_\+t $\ast$}]{Tx\+Data}
\end{DoxyParamCaption}
)}\label{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978}


Transmits I2\+C command array to a I2\+C slave. 


\begin{DoxyParams}{Parameter}
{\em addr} & Slave Address in 7-\/bit format. \\
\hline
{\em rept\+\_\+start} & Command for stop or repeated start. \\
\hline
{\em n\+\_\+size} & Number of transmitting bytes. \\
\hline
{\em $\ast$\+Tx\+Data} & Pointer to I2\+C command bytes to send. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Rückgabe}
error 
\end{DoxyReturn}


Definiert in Zeile 103 der Datei i2c.\+c.


\begin{DoxyCode}
104 \{
105     \textcolor{comment}{/* Copy pointer from TxData */}
106     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_af294cab6f89af5bd936b709e202c8421}{PTxData} = TxData;
107 
108     \textcolor{comment}{/* Set slave address */}
109     UCB0I2CSA = addr;
110 
111     \textcolor{comment}{/* Set Transmit Interrupt */}
112     IE2 = UCB0TXIE;
113 
114     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a374bcaa6a416b8601564a1053ddf78bb}{rept\_start} = rept\_start;
115 
116     \textcolor{comment}{/* Load TX byte counter */}
117     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_aec22639ad7dc7eed52b3e116ea3223fe}{TxByteCtr} = n\_size;
118 
119     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bad208fa8c08969a9d78096817bf0a6377}{TRANSMIT};
120 
121     \textcolor{comment}{/* Send a start condition with write flag */}
122     UCB0CTL1 |= UCTR + UCTXSTT;
123 
124     \textcolor{comment}{/* Wait until Transmition is complet */}
125     \textcolor{keywordflow}{if}(rept\_start == \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a679ee5320d66c8322e310daeb2ee99b8}{STOP}) \{
126         \textcolor{keywordflow}{while}(UCB0STAT & UCBBUSY);
127     \}
128     \textcolor{keywordflow}{else} \{
129         \hyperlink{timer_8c_a3c56af3315c2461dec5ced585a5f84db}{\_delay\_ten\_us}(20);
130     \}
131 
132     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{IDLE};
133 
134     \textcolor{keywordflow}{return} 0;
135 
136 \}
\end{DoxyCode}


Hier ist ein Graph, der zeigt, was diese Funktion aufruft\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=267pt]{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978_cgraph}
\end{center}
\end{figure}




Hier ist ein Graph der zeigt, wo diese Funktion aufgerufen wird\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978_icgraph}
\end{center}
\end{figure}


\hypertarget{i2c_8h_a6691e5911f539e1e8178c6e983e8079a}{}\index{i2c.\+h@{i2c.\+h}!i2c\+\_\+write\+\_\+var@{i2c\+\_\+write\+\_\+var}}
\index{i2c\+\_\+write\+\_\+var@{i2c\+\_\+write\+\_\+var}!i2c.\+h@{i2c.\+h}}
\subsubsection[{i2c\+\_\+write\+\_\+var}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t i2c\+\_\+write\+\_\+var (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{addr, }
\item[{enum {\bf I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}}]{rept\+\_\+start, }
\item[{uint8\+\_\+t}]{n\+\_\+args, }
\item[{}]{...}
\end{DoxyParamCaption}
)}\label{i2c_8h_a6691e5911f539e1e8178c6e983e8079a}


Transmits I2\+C commands with a variable length to a I2\+C slave. 


\begin{DoxyParams}{Parameter}
{\em addr} & Slave Address in 7-\/bit format. \\
\hline
{\em rept\+\_\+start} & Command for stop or repeated start. \\
\hline
{\em n\+\_\+args} & Number of command bytes. \\
\hline
{\em ...} & I2\+C command bytes to send. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Rückgabe}
error 
\end{DoxyReturn}


Definiert in Zeile 67 der Datei i2c.\+c.


\begin{DoxyCode}
68 \{
69     \textcolor{comment}{/* Wait until all transmitions and receptions done */}
70     \textcolor{keywordflow}{while}( \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{IDLE});
71 
72 \textcolor{preprocessor}{#if VARIADIC\_IMPLEMENTATION}
73 
74     \textcolor{comment}{/* Reserve size of memory for transmit buffer if buffer is uninitialised*/}
75     \textcolor{keywordflow}{if}(\hyperlink{i2c_8c_ac20eea448283bc60729067c96d439ae8}{PTxData} == 0) \{
76         \hyperlink{i2c_8c_ac20eea448283bc60729067c96d439ae8}{PTxData} = (uint8\_t *) malloc(n\_args * \textcolor{keyword}{sizeof}(uint8\_t));
77         \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a28b787f8db17314755d031d75ec38017}{TxByteRes} = n\_args;
78     \}
79     \textcolor{comment}{/* Reserve more memory if actual size not enough */}
80     \textcolor{keywordflow}{else} \{
81         \textcolor{keywordflow}{if}(\hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a28b787f8db17314755d031d75ec38017}{TxByteRes} < n\_args) \{
82             \hyperlink{i2c_8c_ac20eea448283bc60729067c96d439ae8}{PTxData} = (uint8\_t *) realloc(\hyperlink{i2c_8c_ac20eea448283bc60729067c96d439ae8}{PTxData}, n\_args * \textcolor{keyword}{sizeof}(uint8\_t));
83             \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a28b787f8db17314755d031d75ec38017}{TxByteRes} = n\_args;
84         \}
85     \}
86 
87 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* VARIADIC\_IMPLEMENTATION */}\textcolor{preprocessor}{}
88 
89     uint8\_t i = 0;
90     va\_list ap;
91 
92     \textcolor{comment}{/* Read n\_args from function}
93 \textcolor{comment}{     * Copy args to transmit buffer}
94 \textcolor{comment}{     */}
95     va\_start(ap, n\_args);
96     \textcolor{keywordflow}{for}(i = 0; i < n\_args; i++)
97         \hyperlink{i2c_8c_ac20eea448283bc60729067c96d439ae8}{PTxData}[i] = va\_arg(ap, uint8\_t);
98     va\_end(ap);
99 
100     \textcolor{keywordflow}{return} \hyperlink{i2c_8c_ae0625b97d3437bcaca4ac4b96dd01978}{i2c\_write\_arr}(addr, rept\_start, n\_args, \hyperlink{i2c_8c_ac20eea448283bc60729067c96d439ae8}{PTxData});
101 \}
\end{DoxyCode}


Hier ist ein Graph, der zeigt, was diese Funktion aufruft\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c_8h_a6691e5911f539e1e8178c6e983e8079a_cgraph}
\end{center}
\end{figure}




Hier ist ein Graph der zeigt, wo diese Funktion aufgerufen wird\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{i2c_8h_a6691e5911f539e1e8178c6e983e8079a_icgraph}
\end{center}
\end{figure}


