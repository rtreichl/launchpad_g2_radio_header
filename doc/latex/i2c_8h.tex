\hypertarget{i2c_8h}{}\section{D\+:/\+G\+I\+T/fhradiov2/driver/i2c.h-\/\+Dateireferenz}
\label{i2c_8h}\index{D\+:/\+G\+I\+T/fhradiov2/driver/i2c.\+h@{D\+:/\+G\+I\+T/fhradiov2/driver/i2c.\+h}}


I2\+C implemtation for M\+S\+P430\+G2553, interrupt based. ~\newline
 This implemtation based on examples from Texas Instruments slaa382. ~\newline
 For more information see link below.  


{\ttfamily \#include $<$stdint.\+h$>$}\\*
{\ttfamily \#include $<$msp430.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$stdarg.\+h$>$}\\*
{\ttfamily \#include $<$driver/timer.\+h$>$}\\*
Include-\/\+Abhängigkeitsdiagramm für i2c.\+h\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c_8h__incl}
\end{center}
\end{figure}
Dieser Graph zeigt, welche Datei direkt oder indirekt diese Datei enthält\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{Aufzählungen}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D} \{ \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a679ee5320d66c8322e310daeb2ee99b8}{S\+T\+O\+P} = 0, 
\hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a807d17ddb75240ddeede2c54fd79bd40}{R\+E\+P\+T}
 \}
\begin{DoxyCompactList}\small\item\em Control command for sendig a S\+T\+O\+P condtion or repeated start. \end{DoxyCompactList}\item 
enum \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9b}{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S} \{ \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{I\+D\+L\+E} = 0, 
\hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bad208fa8c08969a9d78096817bf0a6377}{T\+R\+A\+N\+S\+M\+I\+T}, 
\hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba563f8ed00490ea22ea2605d9571dada8}{R\+E\+C\+E\+I\+V\+E}, 
\hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba2fd6f336d08340583bd620a7f5694c90}{E\+R\+R\+O\+R}
 \}
\begin{DoxyCompactList}\small\item\em Give back a status of I2\+C module. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Funktionen}
\begin{DoxyCompactItemize}
\item 
uint8\+\_\+t \hyperlink{i2c_8h_a1ef889b72b844429bc81225d7b6f4f2e}{i2c\+\_\+init} (uint16\+\_\+t smclk\+\_\+freq, uint16\+\_\+t i2c\+\_\+freq)
\begin{DoxyCompactList}\small\item\em Setup I2\+C with a defined clock based on given S\+M\+C\+K\+L. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{i2c_8h_a6691e5911f539e1e8178c6e983e8079a}{i2c\+\_\+write\+\_\+var} (uint8\+\_\+t addr, enum \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D} rept\+\_\+start, uint8\+\_\+t n\+\_\+args,...)
\begin{DoxyCompactList}\small\item\em Transmits I2\+C commands with a variable length to a I2\+C slave. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978}{i2c\+\_\+write\+\_\+arr} (uint8\+\_\+t addr, enum \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D} rept\+\_\+start, uint8\+\_\+t n\+\_\+size, uint8\+\_\+t $\ast$Tx\+Data)
\begin{DoxyCompactList}\small\item\em Transmits I2\+C command array to a I2\+C slave. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{i2c_8h_a6dd896b0c82d1aa91a1a8155b41c4566}{i2c\+\_\+read} (uint8\+\_\+t addr, enum \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D} rept\+\_\+start, uint8\+\_\+t Rx\+Bytes, uint8\+\_\+t $\ast$Rx\+Data)
\begin{DoxyCompactList}\small\item\em Receives I2\+C commands until a N\+A\+C\+K is received or received Rx\+Bytes. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{i2c_8h_ad2d4889950ea1373a0ea88ba55b04ba8}{i2c\+\_\+get\+\_\+status} ()
\end{DoxyCompactItemize}


\subsection{Ausführliche Beschreibung}
I2\+C implemtation for M\+S\+P430\+G2553, interrupt based. ~\newline
 This implemtation based on examples from Texas Instruments slaa382. ~\newline
 For more information see link below. 

\begin{DoxyAuthor}{Autor}
Richard Treichl 
\end{DoxyAuthor}
\begin{DoxyDate}{Datum}
07.\+02.\+2015
\end{DoxyDate}
\begin{DoxySeeAlso}{Siehe auch}
\href{http://www.ti.com/lit/an/slaa382/slaa382.zip}{\tt http\+://www.\+ti.\+com/lit/an/slaa382/slaa382.\+zip}
\end{DoxySeeAlso}
\begin{DoxyRefDesc}{Noch zu erledigen}
\item[\hyperlink{todo__todo000001}{Noch zu erledigen}]Find a better way for continue \hyperlink{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978}{i2c\+\_\+write\+\_\+arr()} after transmittion on repeated start condition. ~\newline
 Implement error detection, for example wrong configuration for prescale or detect non existing slave.\end{DoxyRefDesc}


\subsection{Dokumentation der Aufzählungstypen}
\hypertarget{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}{}\index{i2c.\+h@{i2c.\+h}!I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D@{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}}
\index{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D@{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}!i2c.\+h@{i2c.\+h}}
\subsubsection[{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}}\label{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5}


Control command for sendig a S\+T\+O\+P condtion or repeated start. 

\begin{Desc}
\item[Aufzählungswerte]\par
\begin{description}
\index{S\+T\+O\+P@{S\+T\+O\+P}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!S\+T\+O\+P@{S\+T\+O\+P}}\item[{\em 
\hypertarget{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a679ee5320d66c8322e310daeb2ee99b8}{}S\+T\+O\+P\label{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a679ee5320d66c8322e310daeb2ee99b8}
}]If this one is set a stop condtion will be send after trasmition or reception. \index{R\+E\+P\+T@{R\+E\+P\+T}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!R\+E\+P\+T@{R\+E\+P\+T}}\item[{\em 
\hypertarget{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a807d17ddb75240ddeede2c54fd79bd40}{}R\+E\+P\+T\label{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a807d17ddb75240ddeede2c54fd79bd40}
}]If this one is set no stop condtion is send the I2\+C stays low on S\+C\+L and wait for a new start condtion. \end{description}
\end{Desc}


Definiert in Zeile 33 der Datei i2c.\+h.


\begin{DoxyCode}
33                   \{
34     \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a679ee5320d66c8322e310daeb2ee99b8}{STOP} = 0,       
35     \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a807d17ddb75240ddeede2c54fd79bd40}{REPT}            
36 \};
\end{DoxyCode}
\hypertarget{i2c_8h_a8f12d82f4a490ef04de32baf91363d9b}{}\index{i2c.\+h@{i2c.\+h}!I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S@{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S}}
\index{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S@{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S}!i2c.\+h@{i2c.\+h}}
\subsubsection[{I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+S\+T\+A\+T\+S}}\label{i2c_8h_a8f12d82f4a490ef04de32baf91363d9b}


Give back a status of I2\+C module. 

\begin{Desc}
\item[Aufzählungswerte]\par
\begin{description}
\index{I\+D\+L\+E@{I\+D\+L\+E}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!I\+D\+L\+E@{I\+D\+L\+E}}\item[{\em 
\hypertarget{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{}I\+D\+L\+E\label{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}
}]Indicates that I2\+C module is not performing a command. \index{T\+R\+A\+N\+S\+M\+I\+T@{T\+R\+A\+N\+S\+M\+I\+T}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!T\+R\+A\+N\+S\+M\+I\+T@{T\+R\+A\+N\+S\+M\+I\+T}}\item[{\em 
\hypertarget{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bad208fa8c08969a9d78096817bf0a6377}{}T\+R\+A\+N\+S\+M\+I\+T\label{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bad208fa8c08969a9d78096817bf0a6377}
}]Indicates that I2\+C module is performing a transmittion command. \index{R\+E\+C\+E\+I\+V\+E@{R\+E\+C\+E\+I\+V\+E}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!R\+E\+C\+E\+I\+V\+E@{R\+E\+C\+E\+I\+V\+E}}\item[{\em 
\hypertarget{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba563f8ed00490ea22ea2605d9571dada8}{}R\+E\+C\+E\+I\+V\+E\label{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba563f8ed00490ea22ea2605d9571dada8}
}]Indicates that I2\+C module is performing a reception command. \index{E\+R\+R\+O\+R@{E\+R\+R\+O\+R}!i2c.\+h@{i2c.\+h}}\index{i2c.\+h@{i2c.\+h}!E\+R\+R\+O\+R@{E\+R\+R\+O\+R}}\item[{\em 
\hypertarget{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba2fd6f336d08340583bd620a7f5694c90}{}E\+R\+R\+O\+R\label{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba2fd6f336d08340583bd620a7f5694c90}
}]Indicates that I2\+C has occured an error. \end{description}
\end{Desc}


Definiert in Zeile 43 der Datei i2c.\+h.


\begin{DoxyCode}
43                     \{
44     \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{IDLE} = 0,       
45     \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bad208fa8c08969a9d78096817bf0a6377}{TRANSMIT},       
46     \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba563f8ed00490ea22ea2605d9571dada8}{RECEIVE},     
47     \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba2fd6f336d08340583bd620a7f5694c90}{ERROR}          
48 \};
\end{DoxyCode}


\subsection{Dokumentation der Funktionen}
\hypertarget{i2c_8h_ad2d4889950ea1373a0ea88ba55b04ba8}{}\index{i2c.\+h@{i2c.\+h}!i2c\+\_\+get\+\_\+status@{i2c\+\_\+get\+\_\+status}}
\index{i2c\+\_\+get\+\_\+status@{i2c\+\_\+get\+\_\+status}!i2c.\+h@{i2c.\+h}}
\subsubsection[{i2c\+\_\+get\+\_\+status}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t i2c\+\_\+get\+\_\+status (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{i2c_8h_ad2d4889950ea1373a0ea88ba55b04ba8}
\begin{DoxyReturn}{Rückgabe}
Actuall state of I2\+C module. 
\end{DoxyReturn}


Definiert in Zeile 166 der Datei i2c.\+c.


\begin{DoxyCode}
167 \{
168     \textcolor{keywordflow}{return} \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status};
169 \}
\end{DoxyCode}
\hypertarget{i2c_8h_a1ef889b72b844429bc81225d7b6f4f2e}{}\index{i2c.\+h@{i2c.\+h}!i2c\+\_\+init@{i2c\+\_\+init}}
\index{i2c\+\_\+init@{i2c\+\_\+init}!i2c.\+h@{i2c.\+h}}
\subsubsection[{i2c\+\_\+init}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t i2c\+\_\+init (
\begin{DoxyParamCaption}
\item[{uint16\+\_\+t}]{smclk\+\_\+freq, }
\item[{uint16\+\_\+t}]{i2c\+\_\+freq}
\end{DoxyParamCaption}
)}\label{i2c_8h_a1ef889b72b844429bc81225d7b6f4f2e}


Setup I2\+C with a defined clock based on given S\+M\+C\+K\+L. 


\begin{DoxyParams}{Parameter}
{\em smclk\+\_\+freq} & Frequency of S\+M\+C\+L\+K clock in Hz \\
\hline
{\em i2c\+\_\+freq} & Frequency for I2\+C clock in Hz \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Rückgabe}
error 
\end{DoxyReturn}


Definiert in Zeile 25 der Datei i2c.\+c.


\begin{DoxyCode}
26 \{
27     \textcolor{comment}{/* Reset USCI\_B0 */}
28     UCB0CTL1 |= UCSWRST;
29 
30     \textcolor{comment}{/* Assign P1.6 and P1.7 to USIC\_B0 */}
31     P1SEL |= BIT6 + BIT7;
32     P1SEL2 |= BIT6 + BIT7;
33 
34     \textcolor{comment}{/* USCI\_B0 as I2C Master */}
35     UCB0CTL0 = UCMST + UCMODE\_3 + UCSYNC;
36 
37     \textcolor{comment}{/* Set SMCLK as clock for USCI\_B0 */}
38     UCB0CTL1 = UCSSEL\_2 + UCSWRST;
39 
40     \textcolor{comment}{/* Calculate prescaler for USCI\_B0 based on SMCLK freq and I2C freq  */}
41     \textcolor{comment}{/*UCB0BR0 = 0x00FF & (uint16\_t)smclk\_freq/i2c\_freq;}
42 \textcolor{comment}{    UCB0BR1 = (0xFF00 & (uint16\_t)smclk\_freq/i2c\_freq) >> 8;*/}
43 
44     UCB0BR0 = 0x14;
45 
46     \textcolor{comment}{/* Enable NACK interrupt */}
47     UCB0I2CIE = UCNACKIE;
48 
49     \textcolor{comment}{/* Resume USCI\_B0 to normal operation state */}
50     UCB0CTL1 &= ~UCSWRST;
51 
52     \textcolor{comment}{/* Enable gloabl interrupts */}
53     \_\_enable\_interrupt();
54 
55     \textcolor{keywordflow}{return} 0;
56 \}
\end{DoxyCode}


Hier ist ein Graph der zeigt, wo diese Funktion aufgerufen wird\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=293pt]{i2c_8h_a1ef889b72b844429bc81225d7b6f4f2e_icgraph}
\end{center}
\end{figure}


\hypertarget{i2c_8h_a6dd896b0c82d1aa91a1a8155b41c4566}{}\index{i2c.\+h@{i2c.\+h}!i2c\+\_\+read@{i2c\+\_\+read}}
\index{i2c\+\_\+read@{i2c\+\_\+read}!i2c.\+h@{i2c.\+h}}
\subsubsection[{i2c\+\_\+read}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t i2c\+\_\+read (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{addr, }
\item[{enum {\bf I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}}]{rept\+\_\+start, }
\item[{uint8\+\_\+t}]{Rx\+Bytes, }
\item[{uint8\+\_\+t $\ast$}]{Rx\+Data}
\end{DoxyParamCaption}
)}\label{i2c_8h_a6dd896b0c82d1aa91a1a8155b41c4566}


Receives I2\+C commands until a N\+A\+C\+K is received or received Rx\+Bytes. 


\begin{DoxyParams}{Parameter}
{\em addr} & Slave Address in 7-\/bit format. \\
\hline
{\em rept\+\_\+start} & Command for stop or repeated start. \\
\hline
{\em Rx\+Bytes} & Number of receiving bytes. \\
\hline
{\em $\ast$\+Rx\+Data} & Pointer where received I2\+C commands are be writtn. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Rückgabe}
error 
\end{DoxyReturn}


Definiert in Zeile 125 der Datei i2c.\+c.


\begin{DoxyCode}
126 \{
127     \textcolor{keywordflow}{while}(\hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{IDLE});
128 
129     \textcolor{comment}{/* Set slave address */}
130     UCB0I2CSA = addr;
131 
132     \textcolor{comment}{/* Change pointer to given buffer */}
133     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a3c8ed69cf31f6ee7aa513fe5f115ba92}{PRxData} = RxData;
134     \textcolor{comment}{/* Load RX counter */}
135     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a37e493c5b47477e45136924079fd9606}{RxByteCtr} = RXBytes;
136 
137     \textcolor{comment}{/* Clear Interrupt */}
138     IE2 = UCB0RXIE;
139 
140     \textcolor{comment}{/* configure receiver mode */}
141     UCB0CTL1 &= ~UCTR;
142 
143     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9ba563f8ed00490ea22ea2605d9571dada8}{RECEIVE};
144 
145     \textcolor{comment}{/* Send a start condition with read flag */}
146     \textcolor{keywordflow}{if} ( \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a37e493c5b47477e45136924079fd9606}{RxByteCtr} == 1 ) \{
147         \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a37e493c5b47477e45136924079fd9606}{RxByteCtr} = 0;
148         \_\_disable\_interrupt();
149         UCB0CTL1 |= UCTXSTT;
150         \textcolor{keywordflow}{while}(UCB0CTL1 & UCTXSTT);
151         UCB0CTL1 |= UCTXSTP;
152         \_\_enable\_interrupt();
153     \}
154     \textcolor{keywordflow}{else} \{
155         \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a37e493c5b47477e45136924079fd9606}{RxByteCtr} -= 2;
156         UCB0CTL1 |= UCTXSTT;
157     \}
158 
159     \textcolor{keywordflow}{while}(UCB0STAT & UCBBUSY);
160 
161     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{IDLE};
162 
163     \textcolor{keywordflow}{return} 0;
164 \}
\end{DoxyCode}


Hier ist ein Graph der zeigt, wo diese Funktion aufgerufen wird\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c_8h_a6dd896b0c82d1aa91a1a8155b41c4566_icgraph}
\end{center}
\end{figure}


\hypertarget{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978}{}\index{i2c.\+h@{i2c.\+h}!i2c\+\_\+write\+\_\+arr@{i2c\+\_\+write\+\_\+arr}}
\index{i2c\+\_\+write\+\_\+arr@{i2c\+\_\+write\+\_\+arr}!i2c.\+h@{i2c.\+h}}
\subsubsection[{i2c\+\_\+write\+\_\+arr}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t i2c\+\_\+write\+\_\+arr (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{addr, }
\item[{enum {\bf I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}}]{rept\+\_\+start, }
\item[{uint8\+\_\+t}]{n\+\_\+size, }
\item[{uint8\+\_\+t $\ast$}]{Tx\+Data}
\end{DoxyParamCaption}
)}\label{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978}


Transmits I2\+C command array to a I2\+C slave. 


\begin{DoxyParams}{Parameter}
{\em addr} & Slave Address in 7-\/bit format. \\
\hline
{\em rept\+\_\+start} & Command for stop or repeated start. \\
\hline
{\em n\+\_\+size} & Number of transmitting bytes. \\
\hline
{\em $\ast$\+Tx\+Data} & Pointer to I2\+C command bytes to send. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Rückgabe}
error 
\end{DoxyReturn}


Definiert in Zeile 90 der Datei i2c.\+c.


\begin{DoxyCode}
91 \{
92     \textcolor{comment}{/* Copy pointer from TxData */}
93     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_af294cab6f89af5bd936b709e202c8421}{PTxData} = TxData;
94 
95     \textcolor{comment}{/* Set slave address */}
96     UCB0I2CSA = addr;
97 
98     \textcolor{comment}{/* Set Transmit Interrupt */}
99     IE2 = UCB0TXIE;
100 
101     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a374bcaa6a416b8601564a1053ddf78bb}{rept\_start} = rept\_start;
102 
103     \textcolor{comment}{/* Load TX byte counter */}
104     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_aec22639ad7dc7eed52b3e116ea3223fe}{TxByteCtr} = n\_size;
105 
106     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bad208fa8c08969a9d78096817bf0a6377}{TRANSMIT};
107 
108     \textcolor{comment}{/* Send a start condition with write flag */}
109     UCB0CTL1 |= UCTR + UCTXSTT;
110 
111     \textcolor{comment}{/* Wait until Transmition is complet */}
112     \textcolor{keywordflow}{if}(rept\_start == \hyperlink{i2c_8h_aaaea3962492fd5ad1e43cba027d949d5a679ee5320d66c8322e310daeb2ee99b8}{STOP}) \{
113         \textcolor{keywordflow}{while}(UCB0STAT & UCBBUSY);
114     \}
115     \textcolor{keywordflow}{else} \{
116         \hyperlink{timer_8c_a3c56af3315c2461dec5ced585a5f84db}{\_delay\_ten\_us}(20);
117     \}
118 
119     \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{IDLE};
120 
121     \textcolor{keywordflow}{return} 0;
122 
123 \}
\end{DoxyCode}


Hier ist ein Graph, der zeigt, was diese Funktion aufruft\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=267pt]{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978_cgraph}
\end{center}
\end{figure}




Hier ist ein Graph der zeigt, wo diese Funktion aufgerufen wird\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c_8h_ae0625b97d3437bcaca4ac4b96dd01978_icgraph}
\end{center}
\end{figure}


\hypertarget{i2c_8h_a6691e5911f539e1e8178c6e983e8079a}{}\index{i2c.\+h@{i2c.\+h}!i2c\+\_\+write\+\_\+var@{i2c\+\_\+write\+\_\+var}}
\index{i2c\+\_\+write\+\_\+var@{i2c\+\_\+write\+\_\+var}!i2c.\+h@{i2c.\+h}}
\subsubsection[{i2c\+\_\+write\+\_\+var}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t i2c\+\_\+write\+\_\+var (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{addr, }
\item[{enum {\bf I2\+C\+\_\+\+C\+R\+T\+L\+\_\+\+C\+M\+D}}]{rept\+\_\+start, }
\item[{uint8\+\_\+t}]{n\+\_\+args, }
\item[{}]{...}
\end{DoxyParamCaption}
)}\label{i2c_8h_a6691e5911f539e1e8178c6e983e8079a}


Transmits I2\+C commands with a variable length to a I2\+C slave. 


\begin{DoxyParams}{Parameter}
{\em addr} & Slave Address in 7-\/bit format. \\
\hline
{\em rept\+\_\+start} & Command for stop or repeated start. \\
\hline
{\em n\+\_\+args} & Number of command bytes. \\
\hline
{\em ...} & I2\+C command bytes to send. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Rückgabe}
error 
\end{DoxyReturn}


Definiert in Zeile 58 der Datei i2c.\+c.


\begin{DoxyCode}
59 \{
60     \textcolor{comment}{/* Wait until all transmitions and receptions done */}
61     \textcolor{keywordflow}{while}( \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{i2c_8h_a8f12d82f4a490ef04de32baf91363d9bafd6a0e4343048b10646dd2976cc5ad18}{IDLE});
62 
63     \textcolor{comment}{/* Reserve size of memory for transmit buffer if buffer is uninitialised*/}
64     \textcolor{keywordflow}{if}(\hyperlink{i2c_8c_af294cab6f89af5bd936b709e202c8421}{PTxData} == 0) \{
65         \hyperlink{i2c_8c_af294cab6f89af5bd936b709e202c8421}{PTxData} = (uint8\_t *) malloc(n\_args * \textcolor{keyword}{sizeof}(uint8\_t));
66         \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a28b787f8db17314755d031d75ec38017}{TxByteRes} = n\_args;
67     \}
68     \textcolor{comment}{/* Reserve more memory if actual size not enough */}
69     \textcolor{keywordflow}{else} \{
70         \textcolor{keywordflow}{if}(\hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a28b787f8db17314755d031d75ec38017}{TxByteRes} < n\_args) \{
71             \hyperlink{i2c_8c_af294cab6f89af5bd936b709e202c8421}{PTxData} = (uint8\_t *) realloc(\hyperlink{i2c_8c_af294cab6f89af5bd936b709e202c8421}{PTxData}, n\_args * \textcolor{keyword}{sizeof}(uint8\_t));
72             \hyperlink{i2c_8c_ac88c1666422f322663fc6c63434dba97}{i2c}.\hyperlink{struct_i2_c___c_t_r_l_a28b787f8db17314755d031d75ec38017}{TxByteRes} = n\_args;
73         \}
74     \}
75 
76     uint8\_t i = 0;
77     va\_list ap;
78 
79     \textcolor{comment}{/* Read n\_args from function}
80 \textcolor{comment}{     * Copy args to transmit buffer}
81 \textcolor{comment}{     */}
82     va\_start(ap, n\_args);
83     \textcolor{keywordflow}{for}(i = 0; i < n\_args; i++)
84         \hyperlink{i2c_8c_af294cab6f89af5bd936b709e202c8421}{PTxData}[i] = va\_arg(ap, uint8\_t);
85     va\_end(ap);
86 
87     \textcolor{keywordflow}{return} \hyperlink{i2c_8c_ae0625b97d3437bcaca4ac4b96dd01978}{i2c\_write\_arr}(addr, rept\_start, n\_args, \hyperlink{i2c_8c_af294cab6f89af5bd936b709e202c8421}{PTxData});
88 \}
\end{DoxyCode}


Hier ist ein Graph, der zeigt, was diese Funktion aufruft\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c_8h_a6691e5911f539e1e8178c6e983e8079a_cgraph}
\end{center}
\end{figure}




Hier ist ein Graph der zeigt, wo diese Funktion aufgerufen wird\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c_8h_a6691e5911f539e1e8178c6e983e8079a_icgraph}
\end{center}
\end{figure}


